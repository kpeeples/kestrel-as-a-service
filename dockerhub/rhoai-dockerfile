FROM quay.io/modh/odh-generic-data-science-notebook:v2
USER root
RUN dnf install -y jq tzdata less gnupg less dnsutils git git-lfs libsndfile && dnf clean all && rm -rf /var/cache/yum
COPY setup-kaas.sh /opt/app-root
RUN chown 1001:0 /opt/app-root/setup-kaas.sh && \
    chmod 775 /opt/app-root/setup-kaas.sh
RUN chmod 775 /opt/app-root/
USER 1001
COPY requirements.txt ./
RUN echo "Installing softwares and packages" && \
    pip install micropipenv && \
    micropipenv install && \
    rm -f ./requirements.txt
RUN git clone https://github.com/opencybersecurityalliance/data-bucket-kestrel.git /opt/app-root/data-bucket-kestrel && \
    git clone https://github.com/opencybersecurityalliance/kestrel-huntbook.git /opt/app-root/kestrel-huntbook && \
    git clone https://github.com/opencybersecurityalliance/kestrel-analytics.git /opt/app-root/kestrel-analytics
RUN chmod -R g+w /opt/app-root/lib/python3.9/site-packages && \
    fix-permissions /opt/app-root -P
